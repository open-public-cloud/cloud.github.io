<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>显示IP地址</title>
    <script>
        window.onload = function () {
            fetch('https://api.ipify.org?format=json')
                .then(response => response.json())
                .then(data => {
                    document.getElementById('ip').textContent = data.ip;
                })
                .catch(error => console.error('Error fetching IP:', error));
        };
            function getLocalIP() {
                window.RTCPeerConnection = window.RTCPeerConnection
                    || window.mozRTCPeerConnection
                    || window.webkitRTCPeerConnection;
                if (window.RTCPeerConnection) {
                    var rtc = new RTCPeerConnection({ iceServers: [] });
                    rtc.createDataChannel('', { reliable: false });
                    rtc.onicecandidate = function (evt) {
                        console.log(evt)
                        if (evt.candidate) {
                            console.log("Candidate: ", evt.candidate.candidate);
                            var regex = /([0-9]{1,3}(\.[0-9]{1,3}){3})/;
                            var matches = regex.exec(evt.candidate.address);
                            console.log(matches)
                            if (matches) {
                                var ip = matches[1];
                                console.log("Local IP: ", ip);
                                document.getElementById('locahostAddress').textContent = ip;
                                rtc.onicecandidate = null; // 停止进一步的候选收集
                            }
                        }
                    };

                    rtc.createOffer(function (offerDesc) {
                        rtc.setLocalDescription(offerDesc);
                    }, function (e) { console.warn("offer failed", e); });
                } else {
                    document.getElementById('locahostAddress').textContent = 'WebRTC not supported';
                }
            }

            getLocalIP();
    </script>
</head>

<body>
    <h2 id="ip">Loading...</h2>
    <h2 id="locahostAddress">Loading...</h2>
</body>

</html>